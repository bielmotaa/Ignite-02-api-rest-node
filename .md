# Guia: Script Knex e Migrations

---

## 1. O comando do script `knex`

```json
"knex": "node --import tsx ./node_modules/knex/bin/cli.js"
```

### O que faz?

Esse script permite rodar o **Knex CLI** usando **TypeScript** diretamente, sem precisar compilar antes.

### Como funciona (parte por parte)?

| Parte | Função |
|-------|--------|
| `node` | Interpreta o JavaScript e executa o Knex |
| `--import tsx` | Usa o tsx como "loader" para entender `.ts` |
| `./node_modules/knex/bin/cli.js` | Ponto de entrada do Knex CLI |

### Por que usar isso?

- O Knex CLI, por padrão, entende só **JavaScript**.
- Seu `knexfile.ts` e suas migrations são **TypeScript**.
- Sem esse script, você teria que:
  - Compilar tudo para JS antes de rodar o knex, ou
  - Mudar `knexfile.ts` e migrations para `.js`.
- Com `--import tsx`, o Node usa o tsx para interpretar `.ts` na hora. Assim você pode manter tudo em TypeScript e rodar sem build prévio.

### Resumo

> Esse script é o "ponte" que permite usar o Knex CLI com TypeScript. Sem ele, o CLI não conseguiria ler seu `knexfile.ts` (onde ta as configuracoes do mue banco) nem suas migrations em `.ts`.

---

## 2. O comando `npm run knex -- migrate:make create-documents`

### Para que serve?

--oq eu for fazer eu informo:create-nome da tabela
-- npm run knex -- migrate:make add-session-id-to-transactions
   --agora com esse comando ele serve nao mais pra criar uma tabela por conmta do add, e sim adcinar um novo campo na tabela ja criada :transactions

Esse comando **cria um arquivo novo** para você descrever mudanças no banco de dados. Ele só cria o arquivo vazio — não altera o banco ainda.

---

### O que ele cria?

Um arquivo `.ts` com um nome parecido com:

```
20250201120000_create-documents.ts
```

Esse arquivo fica dentro de `src/database/migrations/` (ou na pasta configurada no knexfile).

Dentro dele vem algo assim:

```ts
export async function up(knex) {
  // Aqui você vai escrever: criar tabela, colunas, etc.
}

export async function down(knex) {
  // Aqui você vai escrever: desfazer o que fez no up()
}
```

---

### Para que serve o que ele cria?

Esse arquivo é a **migration**. Ele serve para você descrever **como** mudar o banco.

- **`up()`** → o que fazer (ex: criar a tabela `documents` com colunas id, title, etc.)
- **`down()`** → como desfazer (ex: deletar a tabela `documents`)

Depois de preencher, você roda `npm run knex -- migrate:latest` para aplicar as mudanças de verdade no banco.

**Resumindo:** o comando cria um “formulário” vazio. Você preenche com as instruções. Depois outro comando (`migrate:latest`) lê esse formulário e executa no banco.
